<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>UNITIA - RCç‰©ä»¶ç®¡ç†ã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding-bottom: 80px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 30px 20px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }

        h1 {
            color: #667eea;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #666;
            font-size: 14px;
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .mic-container {
            text-align: center;
            padding: 30px 0;
        }

        .mic-button {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 40px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
            position: relative;
        }

        .mic-button:active {
            transform: scale(0.95);
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.4);
        }

        .mic-button.recording {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        .status-text {
            margin-top: 15px;
            color: #666;
            font-size: 14px;
        }

        .transcript-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            min-height: 60px;
            color: #333;
            font-size: 14px;
            line-height: 1.6;
            display: none;
        }

        .transcript-box.show {
            display: block;
        }

        .result-container {
            display: none;
            margin-top: 20px;
        }

        .result-container.show {
            display: block;
        }

        .table-wrapper {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            overflow-x: auto;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }

        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        th {
            background: #667eea;
            color: white;
            font-weight: 600;
        }

        tr:last-child td {
            border-bottom: none;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-stock {
            background: #d4edda;
            color: #155724;
        }

        .badge-purchase {
            background: #fff3cd;
            color: #856404;
        }

        .badge-task {
            background: #d1ecf1;
            color: #0c5460;
        }

        .button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .button-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .button-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .button-secondary {
            background: #e9ecef;
            color: #495057;
            margin-top: 10px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .nav-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
        }

        .nav-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            color: #999;
            font-size: 12px;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .nav-item.active {
            color: #667eea;
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .alert {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .success.show {
            display: block;
        }

        .api-key-notice {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 13px;
            line-height: 1.6;
        }

        .api-key-notice strong {
            display: block;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ï¸ UNITIA</h1>
            <div class="subtitle">RCç‰©ä»¶ç®¡ç†ã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ</div>
        </div>

        <!-- APIã‚­ãƒ¼è¨­å®šé€šçŸ¥ -->
        <div class="api-key-notice">
            <strong>âš ï¸ åˆå›è¨­å®šãŒå¿…è¦ã§ã™</strong>
            ã“ã®ã‚¢ãƒ—ãƒªã‚’ä½¿ç”¨ã™ã‚‹ã«ã¯ã€ã‚³ãƒ¼ãƒ‰å†…ã® <code>GEMINI_API_KEY</code> ã«ã‚ãªãŸã®Gemini APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚
        </div>

        <div class="card">
            <h2 style="color: #333; margin-bottom: 20px; font-size: 20px;">ğŸ¤ ç¾å ´éŸ³å£°ãƒ¡ãƒ¢</h2>
            
            <div class="alert" id="errorAlert"></div>
            <div class="success" id="successAlert"></div>

            <div class="mic-container">
                <button class="mic-button" id="micButton">
                    ğŸ¤
                </button>
                <div class="status-text" id="statusText">ã‚¿ãƒƒãƒ—ã—ã¦éŒ²éŸ³é–‹å§‹</div>
            </div>

            <div class="transcript-box" id="transcriptBox"></div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p style="margin-top: 10px; color: #666;">AIãŒä»•åˆ†ã‘ä¸­...</p>
            </div>

            <div class="result-container" id="resultContainer">
                <h3 style="color: #333; margin-bottom: 15px; font-size: 18px;">ğŸ“Š ä»•åˆ†ã‘çµæœ</h3>
                <div class="table-wrapper" id="tableWrapper"></div>
                <button class="button button-primary" id="copyButton">ğŸ“‹ ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã¸ã‚³ãƒ”ãƒ¼</button>
                <button class="button button-secondary" id="newMemoButton">ğŸ¤ æ–°ã—ã„ãƒ¡ãƒ¢ã‚’éŒ²éŸ³</button>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <div class="nav-item active">
            <div class="nav-icon">ğŸ </div>
            <div>ãƒ›ãƒ¼ãƒ </div>
        </div>
        <div class="nav-item">
            <div class="nav-icon">âœ“</div>
            <div>TODO</div>
        </div>
        <div class="nav-item">
            <div class="nav-icon">ğŸ“·</div>
            <div>å†™çœŸ</div>
        </div>
        <div class="nav-item">
            <div class="nav-icon">ğŸ“</div>
            <div>è¨˜éŒ²</div>
        </div>
    </div>

    <script>
        // =====================================
        // ğŸ”‘ ã“ã“ã«ã‚ãªãŸã®Gemini APIã‚­ãƒ¼ã‚’è¨­å®š
        // =====================================
        const GEMINI_API_KEY = 'AIzaSyANR0vHTnaUwFkyW7kuSfN-5kTLDQErHOg';
        
        // DOMè¦ç´ 
        const micButton = document.getElementById('micButton');
        const statusText = document.getElementById('statusText');
        const transcriptBox = document.getElementById('transcriptBox');
        const loading = document.getElementById('loading');
        const resultContainer = document.getElementById('resultContainer');
        const tableWrapper = document.getElementById('tableWrapper');
        const copyButton = document.getElementById('copyButton');
        const newMemoButton = document.getElementById('newMemoButton');
        const errorAlert = document.getElementById('errorAlert');
        const successAlert = document.getElementById('successAlert');

        // éŸ³å£°èªè­˜ã®è¨­å®š
        let recognition;
        let isRecording = false;
        let transcript = '';

        // Web Speech APIã®åˆæœŸåŒ–
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.lang = 'ja-JP';
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onresult = (event) => {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcriptPiece = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcriptPiece + ' ';
                    } else {
                        interimTranscript += transcriptPiece;
                    }
                }

                transcript = finalTranscript || interimTranscript;
                transcriptBox.textContent = transcript;
                transcriptBox.classList.add('show');
            };

            recognition.onerror = (event) => {
                console.error('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼:', event.error);
                showError('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼: ' + event.error);
                stopRecording();
            };

            recognition.onend = () => {
                if (isRecording) {
                    // éŒ²éŸ³ãŒæ„å›³ã›ãšçµ‚äº†ã—ãŸå ´åˆã¯å†é–‹
                    recognition.start();
                }
            };
        } else {
            showError('ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚Google Chromeã‚’ãŠä½¿ã„ãã ã•ã„ã€‚');
        }

        // ãƒã‚¤ã‚¯ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
        micButton.addEventListener('mousedown', startRecording);
        micButton.addEventListener('touchstart', (e) => {
            e.preventDefault();
            startRecording();
        });

        micButton.addEventListener('mouseup', stopRecording);
        micButton.addEventListener('touchend', (e) => {
            e.preventDefault();
            stopRecording();
        });

        micButton.addEventListener('mouseleave', () => {
            if (isRecording) stopRecording();
        });

        function startRecording() {
            if (!recognition) return;
            
            isRecording = true;
            transcript = '';
            transcriptBox.textContent = '';
            transcriptBox.classList.remove('show');
            resultContainer.classList.remove('show');
            errorAlert.classList.remove('show');
            successAlert.classList.remove('show');

            micButton.classList.add('recording');
            statusText.textContent = 'ğŸ”´ éŒ²éŸ³ä¸­... (é›¢ã™ã¨é€ä¿¡)';

            try {
                recognition.start();
            } catch (e) {
                console.error('éŒ²éŸ³é–‹å§‹ã‚¨ãƒ©ãƒ¼:', e);
            }
        }

        function stopRecording() {
            if (!isRecording) return;

            isRecording = false;
            micButton.classList.remove('recording');
            statusText.textContent = 'ã‚¿ãƒƒãƒ—ã—ã¦éŒ²éŸ³é–‹å§‹';

            try {
                recognition.stop();
            } catch (e) {
                console.error('éŒ²éŸ³åœæ­¢ã‚¨ãƒ©ãƒ¼:', e);
            }

            if (transcript.trim()) {
                processWithClaude(transcript);
            }
        }

        // Gemini APIã§å‡¦ç†
        async function processWithClaude(text) {
            if (GEMINI_API_KEY === 'YOUR_API_KEY_HERE') {
                showError('APIã‚­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ã‚³ãƒ¼ãƒ‰å†…ã®GEMINI_API_KEYã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚');
                return;
            }

            loading.classList.add('show');

            const prompt = `ä»¥ä¸‹ã®ç¾å ´ãƒ¡ãƒ¢ã‚’åˆ†æã—ã€ã€Œé …ç›®åã€ã€Œè©³ç´°ã€ã€ŒåŒºåˆ†ã€ã®3åˆ—ã®Markdownè¡¨å½¢å¼ã§æ•´ç†ã—ã¦ãã ã•ã„ã€‚

åŒºåˆ†ã¯ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã‚’ä½¿ç”¨:
- åœ¨åº«: è‡ªåˆ†ã®åœ¨åº«ã‹ã‚‰æŒå‚ã™ã¹ãã‚‚ã®
- è³¼å…¥: æ–°è¦ã«è³¼å…¥ãŒå¿…è¦ãªã‚‚ã®
- ã‚¿ã‚¹ã‚¯: ä½œæ¥­ã‚„ç¢ºèªäº‹é …

ç¾å ´ãƒ¡ãƒ¢:
${text}

å¿…ãšMarkdownå½¢å¼ã®è¡¨ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚ä¾‹:
| é …ç›®å | è©³ç´° | åŒºåˆ† |
|--------|------|------|
| é…ç®¡ãƒ‘ã‚¤ãƒ— | 2mÃ—3æœ¬ | åœ¨åº« |
| ã‚·ãƒ¼ãƒªãƒ³ã‚°æ | ç™½è‰²ã€2æœ¬ | è³¼å…¥ |
| é˜²æ°´ç¢ºèª | ãƒ™ãƒ©ãƒ³ãƒ€ | ã‚¿ã‚¹ã‚¯ |`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: prompt
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`APIã‚¨ãƒ©ãƒ¼: ${response.status} - ${errorData.error?.message || response.statusText}`);
                }

                const data = await response.json();
                const resultText = data.candidates[0].content.parts[0].text;

                loading.classList.remove('show');
                displayResult(resultText);

            } catch (error) {
                console.error('Gemini API ã‚¨ãƒ©ãƒ¼:', error);
                loading.classList.remove('show');
                showError('AIå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        // çµæœã‚’è¡¨ç¤º
        function displayResult(markdownText) {
            // Markdownè¡¨ã‚’HTMLãƒ†ãƒ¼ãƒ–ãƒ«ã«å¤‰æ›
            const lines = markdownText.trim().split('\n');
            const tableLines = lines.filter(line => line.includes('|'));

            if (tableLines.length < 2) {
                showError('è¡¨å½¢å¼ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ');
                return;
            }

            let html = '<table>';
            
            tableLines.forEach((line, index) => {
                if (index === 1) return; // åŒºåˆ‡ã‚Šè¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—

                const cells = line.split('|')
                    .filter(cell => cell.trim())
                    .map(cell => cell.trim());

                if (index === 0) {
                    html += '<tr>';
                    cells.forEach(cell => {
                        html += `<th>${cell}</th>`;
                    });
                    html += '</tr>';
                } else {
                    html += '<tr>';
                    cells.forEach((cell, cellIndex) => {
                        if (cellIndex === 2) { // åŒºåˆ†åˆ—
                            let badgeClass = 'badge-task';
                            if (cell.includes('åœ¨åº«')) badgeClass = 'badge-stock';
                            else if (cell.includes('è³¼å…¥')) badgeClass = 'badge-purchase';
                            html += `<td><span class="badge ${badgeClass}">${cell}</span></td>`;
                        } else {
                            html += `<td>${cell}</td>`;
                        }
                    });
                    html += '</tr>';
                }
            });

            html += '</table>';
            tableWrapper.innerHTML = html;
            resultContainer.classList.add('show');

            // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼ç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            resultContainer.dataset.markdown = markdownText;
        }

        // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
        copyButton.addEventListener('click', async () => {
            const markdownText = resultContainer.dataset.markdown;
            
            if (!markdownText) {
                showError('ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            // TSVå½¢å¼ã«å¤‰æ›(Excel/ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆäº’æ›)
            const lines = markdownText.trim().split('\n');
            const tableLines = lines.filter(line => line.includes('|'));
            
            const tsvData = tableLines
                .filter((line, index) => index !== 1) // åŒºåˆ‡ã‚Šè¡Œã‚’é™¤å¤–
                .map(line => {
                    return line.split('|')
                        .filter(cell => cell.trim())
                        .map(cell => cell.trim())
                        .join('\t');
                })
                .join('\n');

            try {
                await navigator.clipboard.writeText(tsvData);
                showSuccess('âœ… ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ!Excelã‚„Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è²¼ã‚Šä»˜ã‘ã§ãã¾ã™ã€‚');
            } catch (error) {
                console.error('ã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼:', error);
                showError('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        });

        // æ–°ã—ã„ãƒ¡ãƒ¢ãƒœã‚¿ãƒ³
        newMemoButton.addEventListener('click', () => {
            resultContainer.classList.remove('show');
            transcriptBox.classList.remove('show');
            transcript = '';
            errorAlert.classList.remove('show');
            successAlert.classList.remove('show');
        });

        // ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
        function showError(message) {
            errorAlert.textContent = 'âŒ ' + message;
            errorAlert.classList.add('show');
            setTimeout(() => {
                errorAlert.classList.remove('show');
            }, 5000);
        }

        // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
        function showSuccess(message) {
            successAlert.textContent = message;
            successAlert.classList.add('show');
            setTimeout(() => {
                successAlert.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>
